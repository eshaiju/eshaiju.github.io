
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rails Kitchen</title>
  <meta name="author" content="Shaiju E">

  
  <meta name="description" content="In the previous post about solving N+1 query in graphQL using graphql-batch, we discussed batching queries using the graphql-batch gem. This works &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tech.eshaiju.in">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Rails Kitchen" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-50480030-1']);
    _gaq.push(['_setDomainName','github.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8803494276404199",
        enable_page_level_ads: true
      });
  </script>
</head>


<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Rails Kitchen</a></h1>
  
    <h2>It's a place to write on stuff I learned recently.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tech.eshaiju.in" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://eshaiju.in">Portfolio</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/15/preload-has-many-associations-in-graphql-ruby-using-graphql-preload/">Preload Has_many Associations in Graphql-ruby Using Graphql-preload</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-15T17:11:06+05:30" pubdate data-updated="true">Oct 15<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/10/15/preload-has-many-associations-in-graphql-ruby-using-graphql-preload/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/10/15/preload-has-many-associations-in-graphql-ruby-using-graphql-preload/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
<p>In the previous post about <a href='http://tech.eshaiju.in/blog/2017/05/09/solving-n-plus-1-query-in-graphql-using-graphql-batch/'>solving N+1 query in graphQL using graphql-batch</a>, we discussed batching queries using the <strong> graphql-batch</strong> gem. This works great for belongs_to relationships, but it is not useful for preloading has_many associations. For example, if you wanted the comments for each article, it would again produce N+1 queries. Luckily I found a gem <a href='https://github.com/ConsultingMD/graphql-preload'> graphql-preload</a> that solves this problem. The graphql-preload gem is created based on a <a href='https://gist.github.com/theorygeek/a1a59a2bf9c59e4b3706ac68d12c8434'>gist</a> by @theorygeek. This gem depends on the graphql-batch gem. so we need to keep graphql-batch settings in the schema for graphql-preload work. detailed explanation about graphql batch is given <a href='http://tech.eshaiju.in/blog/2017/05/09/solving-n-plus-1-query-in-graphql-using-graphql-batch'>here</a>.
</p>
<strong>Installation</strong>
<br/><br/>
Add this line to your application&#8217;s Gemfile:

<figure class='code'><figcaption><span>Gemfile</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'graphql-preload'</span></code></pre></td></tr></table></div></figure>

Add <strong>enable_preloading</strong> to the schema file to be able to use this functionality.


<figure class='code'><figcaption><span>app/graphql/graphql_ruby_sample_schema.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">GraphqlRubySampleSchema</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="no">QueryType</span>
</span><span class='line'>  <span class="n">mutation</span> <span class="no">MutationType</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">use</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Batch</span>
</span><span class='line'>  <span class="n">enable_preloading</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Now, for the comments field, for example, we could write it like this:


<figure class='code'><figcaption><span>app/graphql/types/article_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">ArticleType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Article&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:comments</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="no">CommentType</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">preload</span> <span class="ss">:comments</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

We can now throw a query like this at our API without the server with N+1 query problem for has_many association also.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">query</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">articles</span><span class="p">{</span>
</span><span class='line'>    <span class="nb">id</span>
</span><span class='line'>    <span class="n">title</span>
</span><span class='line'>    <span class="n">body</span>
</span><span class='line'>    <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>      <span class="n">comment</span>
</span><span class='line'>      <span class="n">user</span><span class="p">{</span>
</span><span class='line'>        <span class="nb">name</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

Before preload
<img src="/images/before_preload.png" width="1200" height="260">
After preload
<img src="/images/after_preload.png" width="1200" height="260">
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/14/graphql-ruby-mutation-with-input-object-type/">GraphQL Ruby Mutation With Input Object Type</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-14T23:52:38+05:30" pubdate data-updated="true">Oct 14<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/10/14/graphql-ruby-mutation-with-input-object-type/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/10/14/graphql-ruby-mutation-with-input-object-type/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
  <p>In the previous blog post about <a href='http://tech.eshaiju.in/blog/2017/05/15/graphql-mutation-query-implementation-ruby-on-rails/'>GraphQl mutation</a>, we specified each field in input as input_field. This method will do the job but it has some issues.</p>
  Consider an example mutation for saving an article. Here we used the input_field method without InputObjectType.

<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'><span class="k">module</span> <span class="nn">ArticleMutations</span>
</span><span class='line'>  <span class="no">Create</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;AddArticle&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:title</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:body</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define return parameters</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:article</span><span class="p">,</span> <span class="no">ArticleType</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">resolve</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">object</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">|</span>
</span><span class='line'>      <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">title</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:body</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="n">article</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">article</span><span class="p">:</span> <span class="n">article</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">to_a</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mutation</span> <span class="n">addArticle</span><span class="p">{</span>
</span><span class='line'>  <span class="n">addArticle</span><span class="p">(</span><span class="ss">input</span><span class="p">:</span> <span class="p">{</span> <span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;GraphQL mutation&quot;</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="s2">&quot; This article is about graphql mutation using  InputObjectType&quot;</span> <span class="p">})</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">article</span><span class="p">{</span>
</span><span class='line'>      <span class="nb">id</span>
</span><span class='line'>      <span class="n">title</span>
</span><span class='line'>      <span class="n">body</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


For saving this we need to instantiate article object by assigning each and every input params like this.

<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">title</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:title</span><span class="o">]</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:body</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

This method become ugly if our object contain lots fields.
We can define and utilize mutation input params in the better way using <strong>InputObjectType</strong>. If we can specify article object as input_field instead of each field we can save object like below.

<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">inputs</span><span class="o">[</span><span class="ss">:article</span><span class="o">].</span><span class="n">to_h</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

which is maintanable and easy to read.
Lets see how we can achive this.
<br/>
The first step is to define InputObjectType and declare that input object type as input_field. Here we are going to create InputObjectType in another folder inside our graphql folder for maintainability.


<figure class='code'><figcaption><span>app/graphql/input_objects/article_input_object_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">ArticleInputObjectType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:InputObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s1">&#39;ArticleInput&#39;</span>
</span><span class='line'>  <span class="n">input_field</span> <span class="ss">:title</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">input_field</span> <span class="ss">:body</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Since we created new folder for <strong>input_objects</strong>, we have to tell Rails to autoload paths. place below code in <strong>application.rb</strong> to autoload it.


<figure class='code'><figcaption><span>config/application.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app/graphql/input_objects&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

Now we can declare <strong>ArticleInputObjectType</strong> as input_field inside our mutation and use declared input_field inside our mutation resolver to save the article. So final mutation definition will look like this.


<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'><span class="k">module</span> <span class="nn">ArticleMutations</span>
</span><span class='line'>  <span class="no">Create</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;AddArticle&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define input parameters</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:article</span><span class="p">,</span> <span class="o">!</span><span class="no">ArticleInputObjectType</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define return parameters</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:article</span><span class="p">,</span> <span class="no">ArticleType</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">resolve</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">object</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ctx</span><span class="o">|</span>
</span><span class='line'>      <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">inputs</span><span class="o">[</span><span class="ss">:article</span><span class="o">].</span><span class="n">to_h</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="n">article</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">article</span><span class="p">:</span> <span class="n">article</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">to_a</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


That&#8217;s it, we are done, now we can save new article using addArticle mutation.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mutation</span> <span class="n">addArticle</span><span class="p">{</span>
</span><span class='line'>  <span class="n">addArticle</span><span class="p">(</span><span class="ss">input</span><span class="p">:</span> <span class="p">{</span> <span class="ss">article</span><span class="p">:</span> <span class="p">{</span> <span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;GraphQL mutation&quot;</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="s2">&quot; This article is about graphql mutation using  InputObjectType&quot;</span> <span class="p">}</span> <span class="p">})</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">article</span><span class="p">{</span>
</span><span class='line'>      <span class="nb">id</span>
</span><span class='line'>      <span class="n">title</span>
</span><span class='line'>      <span class="n">body</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<img src="/images/graphql-mutation.png" width="1200" height="260" title="" >
If we want to map camel case arguments into DB fields which are in snake case, we can use <strong>as</strong> keyword.

<figure class='code'><figcaption><span>app/graphql/input_objects/comment_input_object_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">CommentInputObjectType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:InputObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s1">&#39;CommentInput&#39;</span>
</span><span class='line'>  <span class="n">input_field</span> <span class="ss">:articleId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:article_id</span>
</span><span class='line'>  <span class="n">input_field</span> <span class="ss">:userId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:user_id</span>
</span><span class='line'>  <span class="n">input_field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

This will convert our input params in snake case so that we can assign this to the object without manually converting into snake case.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">inputs</span><span class="o">[</span><span class="ss">:comment</span><span class="o">].</span><span class="n">to_h</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="p">{</span><span class="s2">&quot;article_id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;New comment&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

You can see sample code <a href="https://github.com/eshaiju/graphql-ruby-sample">here</a>.
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/08/23/deccan-rubyconf-2017-first-experience-as-a-speaker/">Deccan RubyConf 2017 - First Experience as a Speaker</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-08-23T22:02:27+05:30" pubdate data-updated="true">Aug 23<span>rd</span>, 2017</time>
        
           | <a href="/blog/2017/08/23/deccan-rubyconf-2017-first-experience-as-a-speaker/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/08/23/deccan-rubyconf-2017-first-experience-as-a-speaker/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
<img src="/images/decaan2.jpg" width="250" height="220">
<img src="/images/deccan3.jpg" width="225" height="200">
<img src="/images/deccan1.jpg" width="250" height="200">
  <p><a href='http://www.deccanrubyconf.org/'>Deccan RubyConference</a> is a Single-Track Conference happening at Pune every year. Deccan RubyConf 2017 took place 12th Aug. 2017 at Sheraton Grand Pune. The conference covered areas like Ruby Language, Framework, and Tools by well-known speakers and also few first-time speakers from Ruby community.</p>

 I got a chance to attend This year edition as speaker. My topic was <strong><a href='http://slides.com/shaijunonu/graphql-8'>Give REST a rest, use GraphQL for your next Ruby API</a></strong>. In my 25 minutes session, I talked about why should we use GraphQL and also about its implementation in Ruby. After conference session few people from different companies approached me and asked about GraphQL which was really a confidence booster for me as a speaker. Few people shared the issues they faced in GraphQL which given me new ideas and thought process.
<img src="/images/conftalk1.jpg" width="800" height="260" title="Shaiju E" >
<br/>
<p>
The conference started with the keynote by <strong><a href='https://twitter.com/timriley'>Tim Riley</a></strong>. Tim is from Australian and partner at Australian design agency Icelab. He talked about next generation Ruby web apps with dry-rb. Next talk was about leveraging the hidden powers of a database to make Rails, the swiss army knife of web development, manipulate and present data faster by <strong><a href='https://twitter.com/coderhs'>Harisankar</a></strong>, founder of Red Panthers. <strong><a href='https://twitter.com/_tachyons'>Aboobacker MK</a></strong> from Red Panthers talked about Garbage collector in Ruby and some practical tips to improve Ruby performance.</p>
<img src="/images/tim.jpg" width="250" height="250" title="Tim Riley" >
<img src="/images/hari.jpg" width="250" height="200" title="Harisankar" >
<img src="/images/aboobacker.jpg" width="250" height="250" title="Aboobacker MK" >

<p>
After my session, <strong><a href='https://twitter.com/_kanuahs'>Shaunak Pagnis</a></strong> from Amura talked about the Active record and beyond.  After Lunch <strong><a href='https://twitter.com/citizen428'>Michael Kohl</a></strong> from Austria, currently, serves as CTO of Lockstap Labs talked about writing maintainable Rails applications. The sixth session was a panel discussion with the panels including <strong><a href='https://twitter.com/AjeyGore'>Ajey Gore</a></strong> - Group CTO of Go-Jek, <strong><a href='https://twitter.com/vipulnsward'>Vipul</a></strong> - Director BigBinary, Tim Riley, Michael Kohl, <strong><a href='https://twitter.com/gautamrege'>Gautam Rege</a></strong> -Director Josh Software discussed their experience of building a start-up and hiring strategies.
</p>
<img src="/images/shaunak.jpg" width="250" height="200" title="Shaunak Pagnis" >
<img src="/images/Kohl.jpg" width="250" height="200" title="Michael Kohl" >
<img src="/images/panel.jpg" width="250" height="200">
<p>
Followed by Panel Discussion, there were 9 flash talks which included 5 speakers from Kerala, talked about different ruby topics from beginner level to advanced level.  After flash talks, <strong><a href='https://twitter.com/Mistcrafter'>Douglas Vaz</a></strong> talked about HTTP/2 World. Conference session ended with Keynote by Ajey Gore. He talked about testing principles and why testing is important.</p>
<img src="/images/ft1.jpg" width="250" height="200">
<img src="/images/ft2.jpg" width="250" height="200">
<img src="/images/ft3.jpg" width="250" height="200">
<img src="/images/ft4.jpg" width="250" height="200">
<img src="/images/ft5.jpg" width="250" height="200">
<img src="/images/ft6.jpg" width="250" height="200">
<img src="/images/ft7.jpg" width="250" height="200">
<img src="/images/ft8.jpg" width="250" height="200">
<img src="/images/ft9.jpg" width="250" height="200">
<img src="/images/vaz.jpg" width="250" height="200" title="Douglas Vaz" >
<img src="/images/ajay.jpg" width="250" height="200" title="Ajay Gore" >
<p>
After sessions, there were Open hours which gave opportunity meet and interact with different kind of people. For me, it was a great learning experience both listening to people share their contributions and ideas which really inspired me to code better and learn better.</p>
All the photos from the conference is available <a href='https://photos.google.com/share/AF1QipP3Iw5g6YH6MRQnK_kkpXsfRrrJ0J_3VgNX89mifOJp54b6DxJSkOL0BTJAZ9C5yA?key=YjAyR0pGZ3hoZUh1SExPNXJxUk1OV1hhQkx6bjdB'>here</a>.
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/08/05/graphql-security-issues-and-solutions/">GraphQl Security Issues and Solutions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-08-05T12:49:42+05:30" pubdate data-updated="true">Aug 5<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/08/05/graphql-security-issues-and-solutions/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/08/05/graphql-security-issues-and-solutions/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
    <p>One of the main highlights of GraphQl is declarative fetching, the client can define the shape of the data he needed and GraphQL server will provide data in the same shape. But an evil client can exploit this advantage to make deeper nesting and complex queries and can do DDoS attack.<p>
    Example for a deeper nesting query:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">query</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">articles</span><span class="p">{</span>
</span><span class='line'>    <span class="n">title</span>
</span><span class='line'>    <span class="n">body</span>
</span><span class='line'>    <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>      <span class="n">comment</span>
</span><span class='line'>      <span class="n">user</span><span class="p">{</span>
</span><span class='line'>        <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>          <span class="n">user</span><span class="p">{</span>
</span><span class='line'>            <span class="n">comments</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>              <span class="n">comment</span>
</span><span class='line'>              <span class="n">user</span><span class="p">{</span>
</span><span class='line'>                <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>                  <span class="n">comment</span>
</span><span class='line'>                  <span class="n">user</span><span class="p">{</span>
</span><span class='line'>                    <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>                      <span class="n">comment</span>
</span><span class='line'>                      <span class="n">user</span><span class="p">{</span>
</span><span class='line'>                        <span class="nb">name</span>
</span><span class='line'>                      <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                  <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

GraphQL provide three confirations to avoid this issue. <br/><br/>

<strong>Timeout:</strong>
We can avoid queries utilizing server more than specified time by setting a timeout. If a query takes more time for execute, then after time out GraphQL will return the result of query up to that time and simply reject nonexcecuted part of the query.

<figure class='code'><figcaption><span>app/graphql/graphql_ruby_sample_schema.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">GraphqlRubySampleSchema</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="no">QueryType</span>
</span><span class='line'>  <span class="n">mutation</span> <span class="no">MutationType</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">GraphqlRubySampleSchema</span><span class="o">.</span><span class="n">middleware</span> <span class="o">&lt;&lt;</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">::</span><span class="no">TimeoutMiddleware</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">max_seconds</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">err</span><span class="p">,</span> <span class="n">query</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;GraphQL Timeout: </span><span class="si">#{</span><span class="n">query</span><span class="o">.</span><span class="n">query_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<img src="/images/graphql-timeout.png" width="1200" height="260" title="" >
<img src="/images/graphql-timeout-1.png" width="1200" height="260" title="" >

<strong>Maximum Depth:</strong> Another solution for prevent deeply-nested queries is setting <strong>max_deplth</strong>. If our query depth is greater than max_depth we set, the server will simply reject full query and return an error message.

<figure class='code'><figcaption><span>app/graphql/graphql_ruby_sample_schema.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">GraphqlRubySampleSchema</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="no">QueryType</span>
</span><span class='line'>  <span class="n">mutation</span> <span class="no">MutationType</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">max_depth</span> <span class="mi">12</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<img src="/images/graphql-maxdepth.png" width="1200" height="260" title="" >
<strong>Query Complexity:</strong> We can prevent complex queries by setting <strong>max_complexity</strong> in GraphQL schema. Each field in our type system has a complexity number so if our query complexity exceeds max_complexity, the server will reject query just like in the case of max_depth.

<figure class='code'><figcaption><span>app/graphql/graphql_ruby_sample_schema.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">GraphqlRubySampleSchema</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="no">QueryType</span>
</span><span class='line'>  <span class="n">mutation</span> <span class="no">MutationType</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">max_depth</span> <span class="mi">12</span>
</span><span class='line'>  <span class="n">max_complexity</span> <span class="mi">100</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<img src="/images/graphql-maxcomplexity2.png" width="1200" height="260" title="" >
<img src="/images/graphql-maxcomplexity1.png" width="1200" height="260" title="" >
<p>By default complexity of field is 1, but we can configure constant complexity for fields in type system and also can set complexity dynamically by passing conditions </p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Constant complexity:</span>
</span><span class='line'><span class="n">field</span> <span class="ss">:comments</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="no">CommentType</span><span class="o">]</span><span class="p">,</span> <span class="ss">complexity</span><span class="p">:</span> <span class="mi">10</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Dynamic complexity:</span>
</span><span class='line'><span class="n">field</span> <span class="ss">:top_comments</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="no">CommentType</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">argument</span> <span class="ss">:limit</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span><span class="p">,</span> <span class="n">default_value</span><span class="p">:</span> <span class="mi">5</span>
</span><span class='line'>  <span class="n">complexity</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">child_complexity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">ctx</span><span class="o">[</span><span class="ss">:current_user</span><span class="o">].</span><span class="n">admin?</span>
</span><span class='line'>      <span class="c1"># no limit for admin users</span>
</span><span class='line'>      <span class="mi">0</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># `child_complexity` is the value for selections</span>
</span><span class='line'>      <span class="c1"># which were made on the items of this list.</span>
</span><span class='line'>      <span class="c1">#</span>
</span><span class='line'>      <span class="c1"># We don&#39;t know how many items will be fetched because</span>
</span><span class='line'>      <span class="c1"># we haven&#39;t run the query yet, but we can estimate by</span>
</span><span class='line'>      <span class="c1"># using the `limit` argument which we defined above.</span>
</span><span class='line'>      <span class="n">args</span><span class="o">[</span><span class="ss">:limit</span><span class="o">]</span> <span class="o">*</span> <span class="n">child_complexity</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

You can see sample code <a href="https://github.com/eshaiju/graphql-ruby-sample">here</a>.
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/06/09/dry-graphql-definitions-using-interfaces/">DRY GraphQL Definitions Using Interfaces</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-06-09T11:10:47+05:30" pubdate data-updated="true">Jun 9<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/06/09/dry-graphql-definitions-using-interfaces/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/06/09/dry-graphql-definitions-using-interfaces/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
  <p>We can make GraphQL Types and mutations DRY using interfaces. An Interface is an abstract type that contains a collection of types which implement some of the same fields. We can avoid specifying the same set of fields in different GraphQL Types and mutations by defining an interface and using in sharing Types and mutations.</p>
<p>Interfaces can have fields, defined with a field, just like a GraphQL object type. Objects which implement this field inherit field definitions from the interface. An object type can override the inherited definition by redefining that field.</p>
<p>For example, active record time stamps are common fields in Rails models. So we can avoid declaring these fields in all object types by declaring an interface <strong>ActiveRecordTimestamp</strong> with these fields and using it our object types.</p>
We can define ActiveRecordTimestamp like this.


<figure class='code'><figcaption><span>app/graphql/interfaces/active_record_timestamp.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">ActiveRecordTimestamp</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:InterfaceType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s1">&#39;ActiveRecordTimestamp&#39;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:createdAt</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="ss">property</span><span class="p">:</span> <span class="ss">:created_at</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:updatedAt</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="ss">property</span><span class="p">:</span> <span class="ss">:updated_at</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


Since we created a new folder for interfaces, we have to tell Rails to autoload paths. Place below code in application.rb to autoload it.

<figure class='code'><figcaption><span>config/application.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app/graphql/interfaces&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


Now we can add defined interfaces in our object Type using <strong>interfaces</strong> keyword.


<figure class='code'><figcaption><span>app/graphql/types/article_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">ArticleType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Article&quot;</span>
</span><span class='line'>  <span class="n">interfaces</span> <span class="o">[</span><span class="no">ActiveRecordTimestamp</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:body</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:comments</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="no">CommentType</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


Example for including multiple interfaces in Ruby object type.


<figure class='code'><figcaption><span>app/graphql/types/comment_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">CommentType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Comment&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># multiple interfaces included using comma.</span>
</span><span class='line'>  <span class="n">interfaces</span> <span class="o">[</span><span class="no">ActiveRecordTimestamp</span><span class="p">,</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Node</span><span class="o">.</span><span class="n">interface</span><span class="o">]</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:user</span><span class="p">,</span> <span class="no">UserType</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


Now, this active record time stamp will be available in both above-mentioned object types.

<p>We can use return_interfaces to define and reuse return types in different mutation definitions. The result of the resolve block will be passed to the field definitions in the interfaces, and both interface-specific and mutation-specific fields will be available to clients.</p>

For example, we can define a interface which will define notification of a mutation.

<figure class='code'><figcaption><span>app/graphql/interfaces/mutation_result.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">MutationResult</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:InterfaceType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;MutationResult&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:success</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">Boolean</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:notice</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="no">ValidationError</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'><span class="no">CreateArticle</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>  <span class="n">return_field</span> <span class="ss">:title</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">return_field</span> <span class="ss">:body</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">return_interfaces</span> <span class="o">[</span><span class="no">MutationResult</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># clientMutationId will also be available automatically</span>
</span><span class='line'>  <span class="n">resolve</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">article</span><span class="p">,</span> <span class="n">notice</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">create_with_input</span><span class="p">(</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="ss">success</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">persisted?</span>
</span><span class='line'>      <span class="ss">notice</span><span class="p">:</span> <span class="n">notice</span>
</span><span class='line'>      <span class="ss">title</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>      <span class="ss">errors</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">errors</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

   </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/31/graphql-ruby-error-handling/">GraphQL Ruby Error Handling</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-05-31T23:07:58+05:30" pubdate data-updated="true">May 31<span>st</span>, 2017</time>
        
           | <a href="/blog/2017/05/31/graphql-ruby-error-handling/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/05/31/graphql-ruby-error-handling/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
    <p>GraphQL endpoints, we can expose errors as part of our schema. We should check <strong>errors</strong> fields to see if any errors in result data. For example if we query a field which is not existing in type system, we will get a error response. This type of errors is not supposed to be displayed to end users. It helps with debugging, error tracking etc.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Field &#39;user&#39; doesn&#39;t exist on type &#39;Article&#39;&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;locations&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="mi">5</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>        <span class="s2">&quot;query&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;article&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;user&quot;</span>
</span><span class='line'>      <span class="o">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

If a field&#8217;s resolve function returns an ExecutionError, the error will be inserted into the response&#8217;s <strong>errors</strong> key and the field will resolve to nil. It is often required to perform additional validation of the input parameters passed to GraphQL mutations, and provide user-friendly error messages in case validation fails or mutation cannot be completed successfully.
<br/>
For example, we could add errors to ArticleType:

<figure class='code'><figcaption><span>app/graphql/types/article_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">ArticleType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Article&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">resolve</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span> <span class="n">obj</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Then, when clients create a article, they should check the errors field to see if it was successful:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mutation</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">createArticle</span><span class="p">(</span><span class="ss">article</span><span class="p">:</span> <span class="p">{</span><span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;GraphQL is Nice&quot;</span><span class="p">})</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">id</span>
</span><span class='line'>    <span class="n">title</span>
</span><span class='line'>    <span class="n">errors</span> <span class="c1"># in case the save failed</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

If errors are present (and id is null), the client knows that the operation was unsuccessful, and they can discover reason. If some part of our resolve function would raise an error, we can rescue it and add to the <strong>errors</strong> key by returning a GraphQL:: ExecutionError

<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">resolve</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">article_params</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="s2">&quot;article&quot;</span><span class="o">].</span><span class="n">to_h</span>
</span><span class='line'>  <span class="k">begin</span>
</span><span class='line'>    <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">post_params</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># on success, return the article:</span>
</span><span class='line'>    <span class="n">article</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:RecordInvalid</span> <span class="o">=&gt;</span> <span class="n">err</span>
</span><span class='line'>    <span class="c1"># on error, return an error:</span>
</span><span class='line'>    <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ExecutionError</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Invalid input for Article: </span><span class="si">#{</span><span class="n">article</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


If we don&#8217;t want to <strong>begin &#8230; rescue &#8230; end</strong> in every field, we can wrap resolve functions in error handling.<br/> For example, we could make an object that wraps another resolver:


<figure class='code'><figcaption><span>app/graphql/resolvers/rescue_form.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># Wrap field resolver `resolve_func` with a handler for `error_superclass`.</span>
</span><span class='line'><span class="c1"># `RescueFrom` instances are valid field resolvers too.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RescueFrom</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">error_superclass</span><span class="p">,</span> <span class="n">resolve_func</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@error_superclass</span> <span class="o">=</span> <span class="n">error_superclass</span>
</span><span class='line'>    <span class="vi">@resolve_func</span> <span class="o">=</span> <span class="n">resolve_func</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@resolve_func</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
</span><span class='line'>  <span class="k">rescue</span> <span class="vi">@error_superclass</span> <span class="o">=&gt;</span> <span class="n">err</span>
</span><span class='line'>    <span class="c1"># Your error handling logic here:</span>
</span><span class='line'>    <span class="c1"># - return an instance of `GraphQL::ExecutionError`</span>
</span><span class='line'>    <span class="c1"># - or, return nil:</span>
</span><span class='line'>    <span class="kp">nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

apply it to fields on an opt-in basis:

<figure class='code'><figcaption><span>app/graphql/mutations/article_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">field</span> <span class="ss">:create_article</span><span class="p">,</span> <span class="no">ArticleType</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># Wrap the resolve function with `RescueFrom.new(err_class, ...)`</span>
</span><span class='line'>  <span class="n">resolve</span> <span class="no">RescueFrom</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:RecordInvalid</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">})</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<br/>
Reference: <a href='http://graphql-ruby.org/'>GraphQL Ruby website</a>
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/15/graphql-mutation-query-implementation-ruby-on-rails/">GraphQL -Mutation Query Implementation - Ruby on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-05-15T17:37:28+05:30" pubdate data-updated="true">May 15<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/05/15/graphql-mutation-query-implementation-ruby-on-rails/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/05/15/graphql-mutation-query-implementation-ruby-on-rails/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
    <p><strong>Mutation</strong> is a special type of query used to change data in the database like Creating, Editing or Deleting Records from a table or Store. These are the equivalent to the POST, PUT, PATCH and DELETE in HTTP/REST speak. Defining mutations is very similar to defining queries. The only difference is how you implement the logic inside the mutation. In mutation, we can control and specify the output data that API need to return after mutation procedure.</p>
    <p>In this article, I am Adding a mutation query to add comments to an article which we discussed in <a href="http://tech.eshaiju.in/blog/2017/05/09/solving-n-plus-1-query-in-graphql-using-graphql-batch/">previous example</a>.</p>
    To add mutations to your GraphQL schema, first we need to define a mutation type in mutations folder
    
<figure class='code'><figcaption><span>app/graphql/mutations/mutation_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">MutationType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Mutation&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Now we need to pass it into the schema

<figure class='code'><figcaption><span>app/graphql/graphql_ruby_sample_schema.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">GraphqlRubySampleSchema</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="no">QueryType</span>
</span><span class='line'>  <span class="n">mutation</span> <span class="no">MutationType</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Like QueryType, MutationType is a root of the schema. Members of MutationType are mutation fields. For GraphQL in general, mutation fields are identical to query fields except that they have side-effects (which mutate application state, eg, update the database).<br/><br/>
Since we created new folder for mutations, we have to tell Rails to autoload paths. Put below code in application.rb to autoload it.

<figure class='code'><figcaption><span>config/application.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app/graphql/mutations&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

  <p>Now we need to define specific mutation query. Following are the process to define a mutation<br />- give operation a name <br />- declare its inputs<br />- declare its outputs<br />- declare the mutation procedure in resolve block.<br /> <strong>resolve</strong> should return a hash with a key for each of the <strong>return_fields</strong></p>
  In out example, we need to define <strong>CommentMutations</strong> in mutations folder.
  
<figure class='code'><figcaption><span>app/graphql/mutations/comment_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'><span class="k">module</span> <span class="nn">CommentMutations</span>
</span><span class='line'>  <span class="no">Create</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;AddComment&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define input parameters</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:articleId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:userId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define return parameters</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:article</span><span class="p">,</span> <span class="no">ArticleType</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">resolve</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find_by_id</span><span class="p">(</span><span class="n">inputs</span><span class="o">[</span><span class="ss">:articleId</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="s1">&#39;Article not found&#39;</span> <span class="p">}</span> <span class="k">if</span> <span class="n">article</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">comments</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">comments</span>
</span><span class='line'>      <span class="n">new_comment</span> <span class="o">=</span> <span class="n">comments</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:userId</span><span class="o">]</span><span class="p">,</span> <span class="ss">comment</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:comment</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">new_comment</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">article</span><span class="p">:</span> <span class="n">article</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="n">new_comment</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">to_a</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

    Here <strong>input_field</strong> specify the input params we can pass in the query. In <strong>return_field</strong>, we can specify the fields returning after the update. Inside resolve block, we define the business logic. and <strong>resolve</strong> should return a hash with a key for each of the return_fields.<br/><br/>
    After defining this, we need to add the mutation&#8217;s derived field to the mutation type.

<figure class='code'><figcaption><span>app/graphql/mutations/mutation_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">MutationType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Mutation&quot;</span>
</span><span class='line'>  <span class="c1"># Add the mutation&#39;s derived field to the mutation type</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:addComment</span><span class="p">,</span> <span class="ss">field</span><span class="p">:</span> <span class="ss">CommentMutations</span><span class="p">:</span><span class="ss">:Create</span><span class="o">.</span><span class="n">field</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


Now we can try this mutation in GraphiQL:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mutation</span> <span class="n">addComment</span><span class="p">{</span>
</span><span class='line'>  <span class="n">addComment</span><span class="p">(</span><span class="ss">input</span><span class="p">:</span> <span class="p">{</span> <span class="ss">comment</span><span class="p">:</span> <span class="s2">&quot;New comment&quot;</span><span class="p">,</span> <span class="ss">articleId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">userId</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">article</span><span class="p">{</span>
</span><span class='line'>      <span class="nb">id</span>
</span><span class='line'>      <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>        <span class="n">comment</span>
</span><span class='line'>        <span class="n">user</span><span class="p">{</span>
</span><span class='line'>          <span class="nb">name</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

Here’s a possible JSON response for that query:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;addComment&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Good article&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Keep going&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Another Comment&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;David&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;New Comment&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Another Comment from User 2&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;David&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Another Comment from User 1&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;TEST&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;New comment&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="o">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

We can call the same query by passing inputs using variables

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mutation</span> <span class="n">addComment</span><span class="p">(</span><span class="vg">$comments</span><span class="p">:</span> <span class="no">AddCommentInput</span><span class="o">!</span><span class="p">){</span>
</span><span class='line'>  <span class="n">addComment</span><span class="p">(</span><span class="ss">input</span><span class="p">:</span> <span class="vg">$comments</span><span class="p">){</span>
</span><span class='line'>    <span class="n">article</span><span class="p">{</span>
</span><span class='line'>      <span class="nb">id</span>
</span><span class='line'>      <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>        <span class="n">comment</span>
</span><span class='line'>        <span class="n">user</span><span class="p">{</span>
</span><span class='line'>          <span class="nb">name</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="no">Query</span> <span class="no">Variabbles</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;New comment1&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;articleId&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;userId&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<strong>$comments: AddCommentInput!</strong> will configure the variable <strong>$comments</strong> to take values from <strong>query variables</strong> section. <strong>input: $comments</strong> will pass $comments as input to mutation query.</p>
<img src="/images/mutation.png" width="1200" height="260" title="" >

Lets write another example for updation mutation. If we want to update a comment, we need to write UpdateComment mutation in comment_mutations.rb


<figure class='code'><figcaption><span>app/graphql/mutations/comment_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'><span class="k">module</span> <span class="nn">CommentMutations</span>
</span><span class='line'>  <span class="no">Create</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;AddComment&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define input parameters</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:articleId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:userId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define return parameters</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:article</span><span class="p">,</span> <span class="no">ArticleType</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">resolve</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find_by_id</span><span class="p">(</span><span class="n">inputs</span><span class="o">[</span><span class="ss">:articleId</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="s1">&#39;Article not found&#39;</span> <span class="p">}</span> <span class="k">if</span> <span class="n">article</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">comments</span> <span class="o">=</span> <span class="n">article</span><span class="o">.</span><span class="n">comments</span>
</span><span class='line'>      <span class="n">new_comment</span> <span class="o">=</span> <span class="n">comments</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:userId</span><span class="o">]</span><span class="p">,</span> <span class="ss">comment</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:comment</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">new_comment</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">article</span><span class="p">:</span> <span class="n">article</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="n">new_comment</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">to_a</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">Update</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;UpdateComment&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define input parameters</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:id</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:userId</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:articleId</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define return parameters</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="no">CommentType</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">resolve</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">find_by_id</span><span class="p">(</span><span class="n">inputs</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="s1">&#39;Comment not found&#39;</span> <span class="p">}</span> <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">valid_inputs</span> <span class="o">=</span> <span class="ss">ActiveSupport</span><span class="p">:</span><span class="ss">:HashWithIndifferentAccess</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">instance_variable_get</span><span class="p">(</span><span class="ss">:@original_values</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="o">|</span> <span class="n">comment</span><span class="o">.</span><span class="n">respond_to?</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&quot;</span><span class="o">.</span><span class="n">underscore</span> <span class="p">})</span><span class="o">.</span><span class="n">except</span><span class="p">(</span><span class="ss">:id</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">valid_inputs</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">comment</span><span class="p">:</span> <span class="n">comment</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="n">comment</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">to_a</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Main defference here is, we need to create <strong>valid_inputs</strong>. This will allow us mass assignment with update attributes with valied fields which we passed.<br/><br/>
After defining this, we need to add the mutation&#8217;s derived field to the mutation type.

<figure class='code'><figcaption><span>app/graphql/mutations/mutation_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">MutationType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Mutation&quot;</span>
</span><span class='line'>  <span class="c1"># Add the mutation&#39;s derived field to the mutation type</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:addComment</span><span class="p">,</span> <span class="ss">field</span><span class="p">:</span> <span class="ss">CommentMutations</span><span class="p">:</span><span class="ss">:Create</span><span class="o">.</span><span class="n">field</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:updateComment</span><span class="p">,</span> <span class="ss">field</span><span class="p">:</span> <span class="ss">CommentMutations</span><span class="p">:</span><span class="ss">:Update</span><span class="o">.</span><span class="n">field</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


Mutation for delete a comment and return post and deleted comment ID

<figure class='code'><figcaption><span>app/graphql/mutations/comment_mutations.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'><span class="k">module</span> <span class="nn">CommentMutations</span>
</span><span class='line'>  <span class="no">Destroy</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Relay</span><span class="o">::</span><span class="no">Mutation</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;DestroyComment&#39;</span>
</span><span class='line'>    <span class="n">description</span> <span class="s1">&#39;Delete a comment and return post and deleted comment ID&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define input parameters</span>
</span><span class='line'>    <span class="n">input_field</span> <span class="ss">:id</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Define return parameters</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:deletedId</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:article</span><span class="p">,</span> <span class="no">ArticleType</span>
</span><span class='line'>    <span class="n">return_field</span> <span class="ss">:errors</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">resolve</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">_obj</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">comment</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">.</span><span class="n">find_by_id</span><span class="p">(</span><span class="n">inputs</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span> <span class="ss">errors</span><span class="p">:</span> <span class="s1">&#39;Comment not found&#39;</span> <span class="p">}</span> <span class="k">if</span> <span class="n">comment</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">article</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">article</span>
</span><span class='line'>      <span class="n">comment</span><span class="o">.</span><span class="n">destroy</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">{</span> <span class="ss">article</span><span class="p">:</span> <span class="n">article</span><span class="o">.</span><span class="n">reload</span><span class="p">,</span> <span class="ss">deletedId</span><span class="p">:</span> <span class="n">inputs</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Other mutations defined here....</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



<figure class='code'><figcaption><span>app/graphql/mutations/mutation_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">MutationType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Mutation&quot;</span>
</span><span class='line'>  <span class="c1"># Add the mutation&#39;s derived field to the mutation type</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:addComment</span><span class="p">,</span> <span class="ss">field</span><span class="p">:</span> <span class="ss">CommentMutations</span><span class="p">:</span><span class="ss">:Create</span><span class="o">.</span><span class="n">field</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:updateComment</span><span class="p">,</span> <span class="ss">field</span><span class="p">:</span> <span class="ss">CommentMutations</span><span class="p">:</span><span class="ss">:Update</span><span class="o">.</span><span class="n">field</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:destroyComment</span><span class="p">,</span> <span class="ss">field</span><span class="p">:</span> <span class="ss">CommentMutations</span><span class="p">:</span><span class="ss">:Destroy</span><span class="o">.</span><span class="n">field</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Now we can try this mutation in GraphiQL:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">mutation</span> <span class="n">destroyComment</span><span class="p">(</span><span class="vg">$comment</span><span class="p">:</span> <span class="no">DestroyCommentInput</span><span class="o">!</span><span class="p">){</span>
</span><span class='line'>  <span class="n">destroyComment</span><span class="p">(</span><span class="ss">input</span><span class="p">:</span> <span class="vg">$comment</span><span class="p">){</span>
</span><span class='line'>    <span class="n">errors</span>
</span><span class='line'>    <span class="n">article</span><span class="p">{</span>
</span><span class='line'>      <span class="nb">id</span>
</span><span class='line'>      <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>        <span class="nb">id</span>
</span><span class='line'>        <span class="n">comment</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="no">Query</span> <span class="no">Variabbles</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

You can see sample code <a href="https://github.com/eshaiju/graphql-ruby-sample">here</a>.
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/11/graphiql-ide-alternativs-for-development-testing-exploring-graphql-servers/">GraphiQL IDE Alternatives for Development/Testing/Exploring GraphQL Servers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-05-11T20:17:26+05:30" pubdate data-updated="true">May 11<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/05/11/graphiql-ide-alternativs-for-development-testing-exploring-graphql-servers/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/05/11/graphiql-ide-alternativs-for-development-testing-exploring-graphql-servers/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
    <p><a href='https://github.com/graphql/graphiql'>GraphiQL</a> is a graphical interactive in-browser GraphQL IDE. This is a great tool for testing GraphQL endpoints and also for Exploring documentation about GraphQL Servers. There are some limitations for default GraphiQL tool, It does not provide any option for saving queries like we have in postman and other API clients. It only saves the latest query in local storage. Another issue with GraphiQL is, it not providing any option for pass headers into GraphQL queries. It is very critical for the testing of application which needs to pass auth-token or some other headers. In this post Iam exploring few alternativs.</p>
    <strong>GraphQL IDE</strong>
    <p><a href='https://github.com/redound/graphql-ide'>GraphQL IDE</a> is n extensive IDE for exploring GraphQL API&#8217;s. It allows manage projects, import/export, store queries, toggle query history, passing custom headers and setting environment variables for dynamic headers. Currently, it is only available for MacOS. Window / Linux version of this application is under development but can build the binary. If you have Homebrew installed on OSX, you can install it by:</p>
    
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew cask install graphql-ide</span></code></pre></td></tr></table></div></figure>

    Execute queries
    <img src="/images/graphql-ide-1.png" width="1200" height="260" title="" >
    Custom headers
    <img src="/images/graphql-ide-2.png" width="1200" height="260" title="" >
    Environment variables for dynamic headers
    <img src="/images/graphql-ide-3.png" width="1200" height="260" title="" >
    Manage projects
    <img src="/images/graphql-ide-4.png" width="1200" height="260" title="" >
    <br/>
    <strong>GraphiQL.app</strong>
    <p><a href='https://github.com/skevy/graphiql-app'>GraphiQL.app</a> is light, Electron-based wrapper around GraphiQL. This Provides a tabbed interface for editing and testing GraphQL queries/mutations with GraphiQL. It is only available for MacOS. If you have Homebrew installed on OSX, you can install it by:</p>
    
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew cask install graphiql</span></code></pre></td></tr></table></div></figure>

    <img src="/images/graphiql-app.png" width="1200" height="260" title="" >
    <br/>
    <strong>GraphiQL Feen(Chrome Extension)</strong>
    <p><a href='https://chrome.google.com/webstore/detail/graphiql-feen/mcbfdonlkfpbfdpimkjilhdneikhfklp'>GraphiQL Feen</a> is a Chrome Extension that allows you to explore and test GraphQL endpoints. It utilizes the Popular GraphiQL component. It</p>
    <p>Features are: <br /> Save/Load Queries and variables to build a library of useful queries.<br />* Save/Select Server Definitions so you can have different settings for different servers.<br />* GET/POST/Multi-part GraphQL requests supported!<br /> * Authorization defined so cookies forwarded to the domain<br />* Define Headers that will be sent with the request, Headers can even override existing Request headers:<br /> * Define the Origin: header for CORS requests to allow your server to process correctly.<br /> * Define CSRF token headers<br /> * Override all Cookies so you can pass authentication information with your requests.<br />* EXPORT your entire application state to a JSON file<br />* IMPORT saved state so you can restore your state </p>
    <img src="/images/graphql-feen.png" width="1200" height="260" title="" >
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/09/solving-n-plus-1-query-in-graphql-using-graphql-batch/">Solving N+1 Query in GraphQL Using Graphql-batch</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-05-09T23:40:03+05:30" pubdate data-updated="true">May 9<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/05/09/solving-n-plus-1-query-in-graphql-using-graphql-batch/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/05/09/solving-n-plus-1-query-in-graphql-using-graphql-batch/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
    <p>One of the most important pain points in GraphQL is the problem thats commonly referred to as N+1 SQL queries. GraphQL query fields are designed to be stand-alone functions, and resolving those fields with data from a database might result in a new database request per resolved field.</p>
    <p>For a simple RESTful API endpoint logic, it&#8217;s easy to analyze, detect, and solve N+1 issues by enhancing the constructed SQL queries. For GraphQL dynamically resolved fields, it&#8217;s not that simple.</p>
    For example, Consider the GraphQL query to fetch article, its comments and commented user which I mentioned in <a href="http://tech.eshaiju.in/blog/2017/05/08/graphql-server-nested-query-implemenation-example-in-ruby-on-rails/">previous post</a>.
    
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">query</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">acticle</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">){</span>
</span><span class='line'>    <span class="n">title</span>
</span><span class='line'>    <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>      <span class="n">comment</span>
</span><span class='line'>      <span class="n">user</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">id</span>
</span><span class='line'>        <span class="nb">name</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

Output Response

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;acticle&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;A GraphQL Server&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Good article&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Keep going&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Another Comment&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;David&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;New Comment&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Another Comment from User 2&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;David&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Another Comment from User 1&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;TEST&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="o">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<img src="/images/graphql_before.png" width="1200" height="260" title="" >
This will fire user query in for each comment. Total 7 instead of 1 for fetch 2 user. In Rest API we can solve this issue by eager loading users while fetching comments. But GraphQL query fields are designed to be stand-alone functions, and not aware of other functions.
<p>Facebook introduced DataLoader to solve this problem in Javascript projects. Shopify created <a href='https://github.com/Shopify/graphql-batch' >GraphQL::Batch</a> to solve this N+1 problem in ruby.<br />GraphQL::Batch Provides an executor for the graphql gem which allows queries to be batched. This is a flexible toolkit for lazy resolution with GraphQL.</p>
Installation

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;graphql-batch&#39;</span>
</span></code></pre></td></tr></table></div></figure>

Now we need to define a custom loader, which is initialized with arguments that are used for grouping and a perform method for performing the batch load.

<figure class='code'><figcaption><span>app/graphql/record_loader.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="nb">require</span> <span class="s1">&#39;graphql/batch&#39;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RecordLoader</span> <span class="o">&lt;</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Batch</span><span class="o">::</span><span class="no">Loader</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@model</span> <span class="o">=</span> <span class="n">model</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@model</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">ids</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">record</span><span class="o">|</span> <span class="n">fulfill</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">ids</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span> <span class="n">fulfill</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span> <span class="k">unless</span> <span class="n">fulfilled?</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Now we need to GraphQL::Batch as a plugin in your schema

<figure class='code'><figcaption><span>app/graphql/graphql_ruby_sample_schema.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">GraphqlRubySampleSchema</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="ss">Types</span><span class="p">:</span><span class="ss">:QueryType</span>
</span><span class='line'>  <span class="n">mutation</span> <span class="ss">Mutations</span><span class="p">:</span><span class="ss">:MutationType</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">use</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:Batch</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

In our comments api example, we need to use above initialized RecordLoader for lazily execute User query

<figure class='code'><figcaption><span>app/graphql/types/comment_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="k">module</span> <span class="nn">Types</span>
</span><span class='line'>  <span class="no">CommentType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;Comment&quot;</span>
</span><span class='line'>    <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span>
</span><span class='line'>    <span class="n">field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>    <span class="n">field</span> <span class="ss">:user</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="no">UserType</span> <span class="p">}</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">resolve</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="no">RecordLoader</span><span class="o">.</span><span class="n">for</span><span class="p">(</span><span class="no">User</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Here,  <strong>resolve -&gt; (obj, args, ctx) {RecordLoader.for(User).load(obj.user_id) }</strong> will make user fetching lazy loading there by solve N+1 query problem.
<img src="/images/graphql_example.png" width="1200" height="260" title="" >
Before:
<img src="/images/graphql_before.png" width="1200" height="260" title="" >
After
<img src="/images/graphql_after.png" width="1200" height="260" title="" >
<p>More information about GraphQL::Batch is available in <a href='https://github.com/Shopify/graphql-batch' >Gem Documentation</a><br/>
You can see sample code <a href="https://github.com/eshaiju/graphql-ruby-sample">here</a>.</p>
  </div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/08/graphql-server-nested-query-implemenation-example-in-ruby-on-rails/">GraphQL Server - Nested Query Implementation Example in Ruby on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-05-08T21:28:51+05:30" pubdate data-updated="true">May 8<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/05/08/graphql-server-nested-query-implemenation-example-in-ruby-on-rails/#disqus_thread"
             data-disqus-identifier="http://tech.eshaiju.in/blog/2017/05/08/graphql-server-nested-query-implemenation-example-in-ruby-on-rails/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
  <div dir="ltr" style="text-align: left;" trbidi="on">
    <p>One of the main advantages of GraphQL is, we can create queries with a different combination of datasets which will avoid multiple requests to fetch required data, thereby eliminating overheads. In this post, I am discussing how we can create nested datasets in GraphQL.

    <br /> <br />
    In the <a href="http://tech.eshaiju.in/blog/2017/05/06/a-graphql-server-implementation-ruby-on-rails/">previous post</a>, I mentioned about Article model and query to fetch an article. Here I&#8217;m going to fetch comments under the article. Assuming we have comments and user model with corresponding associations.</p>

    Now we need to add CommentType.
    
<figure class='code'><figcaption><span>app/graphql/types/comment_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">CommentType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Comment&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:comment</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:user</span><span class="p">,</span> <span class="no">UserType</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


    Here we are exposing commented user which is UserType. So we need to define that type also in user_type.rb
    
<figure class='code'><figcaption><span>app/graphql/types/user_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">UserType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;User&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


    Now we need to expose comments inside article model
    
<figure class='code'><figcaption><span>app/graphql/types/article_type.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="no">ArticleType</span> <span class="o">=</span> <span class="ss">GraphQL</span><span class="p">:</span><span class="ss">:ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Article&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Int</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:body</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:comments</span><span class="p">,</span> <span class="n">types</span><span class="o">[</span><span class="no">CommentType</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

    <p>Here comments are an array of objects so we need to specify CommentType using <strong>types</strong> keyword. We can see in comment_type.rb we are not specifying types for UserType, as it is returning a single object. Since we defined association in, This will fetch all comments of the article by executing article.comments.</p>
Put below code in application.rb to autoload graphql and types folder like so:

<figure class='code'><figcaption><span>config/application.rb</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app/graphql&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app/graphql/types&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


    Here&rsquo;s an example of a GraphQL query that a client can use to ask a server about the title of the article, corresponding comments and commented user:
    
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">query</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">article</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">){</span>
</span><span class='line'>    <span class="n">title</span>
</span><span class='line'>    <span class="n">comments</span><span class="p">{</span>
</span><span class='line'>      <span class="n">comment</span>
</span><span class='line'>      <span class="n">user</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">id</span>
</span><span class='line'>        <span class="nb">name</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

    Here’s a possible JSON response for that query:
    
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;article&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;A GraphQL Server&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;comments&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Good article&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Keep going&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Shaiju E&quot;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="o">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

    You can see sample code <a href="https://github.com/eshaiju/graphql-ruby-sample">here</a>.
  </div>
</div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/10/15/preload-has-many-associations-in-graphql-ruby-using-graphql-preload/">Preload Has_many Associations in Graphql-ruby Using Graphql-preload</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/14/graphql-ruby-mutation-with-input-object-type/">GraphQL Ruby Mutation With Input Object Type</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/08/23/deccan-rubyconf-2017-first-experience-as-a-speaker/">Deccan RubyConf 2017 - First Experience as a Speaker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/08/05/graphql-security-issues-and-solutions/">GraphQl Security Issues and Solutions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/09/dry-graphql-definitions-using-interfaces/">DRY GraphQL Definitions Using Interfaces</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/31/graphql-ruby-error-handling/">GraphQL Ruby Error Handling</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/15/graphql-mutation-query-implementation-ruby-on-rails/">GraphQL -Mutation Query Implementation - Ruby on Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/11/graphiql-ide-alternativs-for-development-testing-exploring-graphql-servers/">GraphiQL IDE Alternatives for Development/Testing/Exploring GraphQL Servers</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Subscribe</h1>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
   <form action="//eshaiju.us10.list-manage.com/subscribe/post?u=7582b7373d9b93dff66b353bf&amp;id=469e7925c9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

      <div class="mc-field-group">
  <label for="mce-EMAIL">
    Enter your email to receive updates
  </label>
  <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="you@email.com">
      </div>
      <div id="mce-responses" class="clear">
  <div class="response" id="mce-error-response" style="display:none"></div>
  <div class="response" id="mce-success-response" style="display:none"></div>
      </div>
      <div class="clear">
  <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
      </div>
    </form>
  </div>
  <!--End mc_embed_signup-->
</section>

<style type="text/css">
	
#mce-EMAIL{
	width: 100%; height: 24px; margin-top: 8px; font-size: 14px;
}

#mc-embedded-subscribe {
	  background-color: #5DA423;
	  border: 1px solid #396516;
	  width: auto;
	  background: #2BA6CB;
	  border: 1px solid #1E728C;
	  -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset;
	  -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset;
	  box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset;
	  color: white;
	  cursor: pointer;
	  display: inline-block;
	  font-size: 14px;
	  font-weight: bold;
	  line-height: 1;
	  margin: 8px 0 0 0;
	  outline: none;
	  padding: 10px 20px 11px;
	  position: relative;
	  text-align: center;
	  text-decoration: none;
	  -webkit-transition: background-color 0.15s ease-in-out;
	  -moz-transition: background-color 0.15s ease-in-out;
	  -o-transition: background-color 0.15s ease-in-out;
	  transition: background-color 0.15s ease-in-out;
    }
</style>
<section class="even">
	<h1>
	  <a href="https://github.com/eshaiju"><img src="/images/github_zpse87fc53d.jpg" width="40" height="40"></a>
	  &nbsp;
	  <a href="https://twitter.com/eshaiju"><img src="/images/twitter_zps447bd274.jpg" width="40" height="40"></a>
	</h1>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Shaiju E -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'eshaijugithubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>






  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50480030-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
