<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Kannel | TechSleek]]></title>
  <link href="http://eshaiju.github.io/blog/categories/kannel/atom.xml" rel="self"/>
  <link href="http://eshaiju.github.io/"/>
  <updated>2014-04-28T00:22:53+05:30</updated>
  <id>http://eshaiju.github.io/</id>
  <author>
    <name><![CDATA[Shaiju E]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Changing Kannel Log Level & Log Rotation]]></title>
    <link href="http://eshaiju.github.io/blog/2013/11/03/changing-kannel-log-level-log-rotation/"/>
    <updated>2013-11-03T12:40:00+05:30</updated>
    <id>http://eshaiju.github.io/blog/2013/11/03/changing-kannel-log-level-log-rotation</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">
  If Kannel is configured so that the bearerbox, wapbox and/or smsbox log to file each of these log files will continue to grow unless administered in some way. &nbsp;One way of reducing logs is by change log level.&nbsp;kannel allow to have 5 log-level ( 0 - debug, 1 - info, 2 - warning, 3 - error, 4 - panic).&nbsp;We can change log level by editing log-level component in configuration file and also done by admin HTTP command without restaring bearerbox.
  {%codeblock%}
  http://localhost:13000/log-level?password=bar&amp;level=2
  {%endcodeblock%}
  Another way of administering log files is to 'rotate' the logs on a regular basis using a tool such as logrotate. A sample logrotate script is shown below.<br />
  Setup Logrotate<br /><br />
  Step 1 : If logrotate is not already on your VPS, install it now.<br />
  {%codeblock%}sudo apt-get install logrotate{%endcodeblock%}
  Step 2 : Add following script in file  <span style="font-weight: bold;">/etc/logrotate.d</span>
  {%codeblock%}
  /var/log/kannel/*.log {daily
                         missingok
                         rotate 365
                         compress
                         delaycompress
                         notifempty
                         create 640 kannel adm
                         sharedscripts
                         postrotate
                         killall -HUP bearerbox smsbox wapbox || true &gt; /dev/null 2&gt; /dev/null
                         endscript
                        }
{%endcodeblock%}
In this example the Kannel log files found in <span style="font-weight: bold;">/var/log/kannel</span> are rotated and compressed daily over 365 days.&nbsp;To verify if a particular log is rotating or not and to check the last date and time of its rotation, check the <span style="font-weight: bold;"> /var/lib/logrotate/status </span>file.
{%codeblock%}
cat /var/lib/logrotate/status
{%endcodeblock%}
</div></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing and Configuring SQL-Based Queue Engine for Kannel (Sqlbox)]]></title>
    <link href="http://eshaiju.github.io/blog/2013/10/31/installing-and-configuring-sql-based/"/>
    <updated>2013-10-31T00:57:00+05:30</updated>
    <id>http://eshaiju.github.io/blog/2013/10/31/installing-and-configuring-sql-based</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">
  Sqlbox is a special Kannel box that sits between bearerbox and smsbox and uses a database queue to store and forward messages.Messages are queued on a configurable table (defaults to send_sms) and moved to another table (defaults to sent_sms) afterwards.
  <br />
  After installing gateway, we need to compile Sqlbox.
  <br />
  Steps:<br /><br />&nbsp;
  1 - cd into directory where Kannel is unzipped and then type the following commands<br />
  {% codeblock %}
    cd addons/sqlbox/
sudo ./bootstrap
sudo ./configure --with-kannel-dir=/usr/local/kannel-1.5.0/
sudo make bindir=/usr/local/kannel/kannel-1.5.0/
{% endcodeblock %}
  2 -Create a file named smsbox.conf and following configuration
{%codeblock%}
#SQL BOX CONFIG

group = sqlbox
id = sqlbox-db
smsbox-id = sqlbox
global-sender = ""
bearerbox-host = localhost
bearerbox-port = 13010
smsbox-port = 13020
smsbox-port-ssl = false
sql-log-table = sent_sms
sql-insert-table = send_sms
log-file = "/var/log/kannel/kannel-sqlbox.log"

# Database connection examples. Please uncomment as needed
# Example MYSQL Connection

group = mysql-connection
id = sqlbox-db
host = localhost
username = username
password = password
database = kannel_db
{%endcodeblock%}

3 - create &nbsp;send_sms table using following sql command
{%codeblock%}
CREATE TABLE `send_sms` (
                          `sql_id` bigint(20) NOT NULL auto_increment,
                          `momt` enum('MO','MT') default NULL,
                          `sender` varchar(20) default NULL,
                          `receiver` varchar(20) default NULL,
                          `udhdata` blob,<br />&nbsp; `msgdata` text,
                          `time` bigint(20) default NULL,
                          `smsc_id` varchar(255) default NULL,
                          `service` varchar(255) default NULL,
                          `account` varchar(255) default NULL,
                          `id` bigint(20) default NULL,
                          `sms_type` bigint(20) default NULL,
                          `mclass` bigint(20) default NULL,
                          `mwi` bigint(20) default NULL,
                          `coding` bigint(20) default NULL,
                          `compress` bigint(20) default NULL,
                          `validity` bigint(20) default NULL,
                          `deferred` bigint(20) default NULL,
                          `dlr_mask` bigint(20) default NULL,
                          `dlr_url` varchar(255) default NULL,
                          `pid` bigint(20) default NULL,
                          `alt_dcs` bigint(20) default NULL,
                          `rpi` bigint(20) default NULL,
                          `charset` varchar(255) default NULL,
                          `boxc_id` varchar(255) default NULL,
                          `meta_data` varchar(255) default NULL,
                          `foreign_id` bigint(20) default NULL,
                          `binfo` varchar(255) default NULL,
                          PRIMARY KEY (`sql_id`)) ENGINE=MyISAM DEFAULT CHARSET=latin1;
{%endcodeblock%}

4 - Create &nbsp;sent_sms table using same structure with changing table name <br />
Now start bearerbox and sqlbox using commands
{%codeblock%}
sudo /usr/local/kannel-1.5.0/sbin bearerbox /home/shaiju/kannel/kannel.conf
sudo /usr/local/kannel-1.5.0/sbin sqlbox /home/shaiju/kannel/sqlbox.conf
{%endcodeblock%}
Example<br />
As when you're using the sendsms interface, you don't need to specify all the columns in order to succesfully enqueue a message.<br />
Here's an example query you can use to send a simple message using Sqlbox:
{%codeblock%}
INSERT INTO send_sms ( &nbsp;momt, sender, receiver, msgdata, sms_type, smsc_id) VALUES ( &nbsp;'MT', 'TESTID', '9995323922', 'Hello world', 2,'testsmsc1');
{%endcodeblock%}
The former example would send a message with text "Hello world" to number "9995323922". If possible, the sender would be set to "TESTID".You can add other parameters to specify routing, charset encoding and any other settings your setup may require<br />
If you are keen to learn more about this , Refer <a href="http://www.blogalex.com/wp-content/uploads/2008/11/userguide.html">Here</a><br />
</div></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kannel Monitoring Tool - Ruby Gem]]></title>
    <link href="http://eshaiju.github.io/blog/2013/10/03/kannel-monitoring-tool-ruby-gem/"/>
    <updated>2013-10-03T23:47:00+05:30</updated>
    <id>http://eshaiju.github.io/blog/2013/10/03/kannel-monitoring-tool-ruby-gem</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">
  <div>Last few months I have been facing lots of issues in kannel SMS gateway.Some time sms are getting queued up, in some other time smsc went to reconnecting stage. I searched for a tool which will monitor kannel status Unfortunately i didn't find a tool to monitor and give alert. so decided to write a tool which will monitor kannel activities.</div>
  {% codeblock %}
    kannel_monitor 0.0.2
  {% endcodeblock %}
  This gem will monitor<br />
  <ul>
    <li>&nbsp; &nbsp;kannel status</li>
    <li>&nbsp; &nbsp;kannel sms queue</li>
    <li>&nbsp; &nbsp;smsc status</li>
    <li>&nbsp; &nbsp;smsc queue and will send a email alerts when something went wrong.</li>
  </ul>
  Just install gem in server using 
    {% codeblock %}
      gem install kannel_monitor
    {% endcodeblock %}
  run monitoring activity using command 
  {% codeblock %}
    kannel_monitor 'path to kannel_monitor.yml'
  {% endcodeblock %}
   Example of <b>yml</b> file is given&nbsp;<b><a href="https://github.com/shaijunonu/kannel-monitor/blob/master/config/kannel_monitor.yml" style="color: #1155cc;">Here</a>.
   </b><br /><span>you need to set a crone job to run this in a specific intervals. If a smsc is permanently reconection stage and you don't want to monitor that smsc, then you can skip that particular smsc by adding in <b>sms_to_be_skipped&nbsp;</b></span>
</div></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Configuring MySQL DLR Storage]]></title>
    <link href="http://eshaiju.github.io/blog/2013/09/09/configuring-mysql-dlr-storage/"/>
    <updated>2013-09-09T18:45:00+05:30</updated>
    <id>http://eshaiju.github.io/blog/2013/09/09/configuring-mysql-dlr-storage</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">To support mysql, we have to recompile kannel with --mysql 
{% codeblock %}
./configure --prefix=/usr/local/kannel --with-mysql
{% endcodeblock %}
To store DLR information into a MySQL database you may use the dlr-storage = mysql configuration directive in the core group.In addition to that you must have a dlr-db group defined that specifies the table field names that are used to the DLR attributes and a mysql-connection group that defines the connection to the MySQL server itself.
<br/>
Here is the example configuration
{% codeblock %}
group = core
.........
dlr-storage = mysql
group = mysql-connection
id = mydlr
host = localhost
username = foo
password = bar
database = dlr
max-connections = 1
group = dlr-db
id = mydlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
{% endcodeblock %}
Create table dlr<br /><br />
{% codeblock %}
CREATE TABLE dlr (smsc varchar(40),
                  ts varchar(40),
                  destination varchar(40),
                  source varchar(40),
                  service varchar(40),
                  url varchar(255),
                  mask int(10),
                  status int(10),
                  boxc varchar(40))
{% endcodeblock %}
</div>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kannel Installation and Configuration as SMS Gateway Server]]></title>
    <link href="http://eshaiju.github.io/blog/2013/09/01/kannel-installation-and-configuration/"/>
    <updated>2013-09-01T17:53:00+05:30</updated>
    <id>http://eshaiju.github.io/blog/2013/09/01/kannel-installation-and-configuration</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">Kannel is an open source WAP gateway and &nbsp;SMS gateway for GSM networks. &nbsp;The main use for Kannel is to link HTTP based services to various SMS centers using obscure protocols.Kannel is mainly being developed on Linux systems, and should be fairly easy to port to other Unix-like systems. However, kannel don't yet support other platforms.<br /><br /><b>Kannel Installation and Configuration as SMS gateway Server</b><br /><b>Installation</b><br />1 Before installing kannel you will need to install libxml. Download the source and follow the next steps for installation.We can download it from following link.<span style="color: #7a7a7a;">&nbsp;</span><a href="ftp://gd.tuwien.ac.at/pub/libxml/" style="background-color: white; border: 0px; color: #f3686d; font-family: Georgia, Times, serif; font-size: 14px; line-height: 21px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;" target="_blank">ftp://gd.tuwien.ac.at/pub/libxml/</a><br />2 Unzip it into some directory<br />3 Cd into directory where libxml is unzipped and then type the following commands<br />4 Type ./configure<br />5 Type make<br />6 Type make install<br />&nbsp; &nbsp;now you have libxml<br />7 Download latest version of Kannel <a href="http://www.kannel.org/download.shtml">http://www.kannel.org/download.shtml</a>&nbsp;and Unzip it into some directory &nbsp;or use svn co </span><a href="https://svn.kannel.org/gateway/trunk" style="white-space: pre-wrap;">https://svn.kannel.org/gateway/trunk</a>&nbsp; <span style="white-space: pre-wrap;"> to download latest version of gateway</span><br />8 cd into directory where Kannel is unzipped and then type the following commands<br />9 Type &nbsp;<span style="white-space: pre-wrap;">./configure --prefix=/usr/local/kannel-1.5.0 </span><span style="white-space: pre-wrap;">--enable-start-stop-daemon --with-mysql</span><br />10 Type make<br />11 Type make install<br /><br />&nbsp;Now kannel is ready<br /><br />Next step is to add configuration<br /><br />Kannel consists of three programs, usually run as &nbsp;daemons: &nbsp;bearerbox, wapbox, and smsbox. They implement the connection to the phone (SMS or UDP), the WAP protocol stack, and the SMS based services, respectively.<br /><br />We will need only &nbsp;bearerbox and smsbox as we are going to setup it as SMS gateway server. Bearerbox is the main queue and smsbox handles the smscs.<br /><br />Create a file named kannel.conf and add following configuration<br /><br />

  {% codeblock %}
#---------------------------------------------
# CORE
#
# There is only one core group and it sets all basic settings of the bearerbox (and system).
group = core
admin-port = 13000
admin-password = passwd##
smsbox-port = 13010
log-file = "/var/log/kannel/kannel.log"
# Log level is DEBUG
log-level = 
access-log = "/var/log/kannel/access.log"
store-type = spool
# Let no SMS be lost as far as possible
store-location = "/var/spool/kannel"
# Acceptable retries for temporary failures in sending SMS
sms-resend-retry = 3
#---------------------------------------------
# SMSBOX SETUP
#
# Smsbox(es) do higher-level SMS handling after they have been received from SMS centers by #bearerbox, or before they are given to bearerbox for delivery
group = smsbox
bearerbox-host = localhost
sendsms-port = 13020
log-file = "/var/log/kannel/smsbox.log"
# Log level is DEBUG
log-level = 0
access-log = "/var/log/kannel/access.log"
#---------------------------------------------
# SEND-SMS USERS
# These users are used when Kannel smsbox sendsms interface is used to send PUSH sms messages
group = sendsms-user
username = tester
password = foobar
concatenation = true
max-messages = 4
#---------------------------------------------
# SMSC CONNECTIONS
# SMSC connections are created in bearerbox and they handle SMSC 
# protocol and message relying.
# Example complete configuration
group = smsc
smsc = smpp
smsc-id = PROMO-SERVICE-MESSAGE
allowed-smsc-id = PROMO-SERVICE-MESSAGE
host = X.X.X.X
port = XXXX
transceiver-mode = true
smsc-username = promouser
smsc-password = promopasswd
source-addr-ton = 0
source-addr-npi = 1
dest-addr-ton = 0
dest-addr-npi = 1
system-type = ""
address-range = "" 
{% endcodeblock %}
  Now start smsbox and bearerbox using 
{% codeblock %}
  sudo /usr/local/kannel-1.5.0/sbin/bearerbox /home/shaiju/kannel/kannel.conf
sudo /usr/local/kannel-1.5.0/sbin/smsbox /home/shaiju/kannel/kannel.conf
{% endcodeblock %}
To see running process use
{% codeblock %}
  sudo ps -ef | grep kannel
{% endcodeblock %}
To stop the kannel service
{% codeblock %}/etc/init.d/kannel stop{% endcodeblock %}
To see kannel logs
{% codeblock %}tail -f /var/log/kannel/kannel.log{% endcodeblock %}
Now you can send sms using send sms url
{% codeblock %}http://kannel.machine.ip:13010/cgi-bin/sendsms?username=tester&amp;password=foobar&amp;from=SENDERID&amp;to=9999999999&amp;text=test sms &amp;smsc=PROMO-SERVICE-MESSAGE{% endcodeblock %}
If you are keen to learn more about this , Refer&nbsp;</span><a href="http://www.kannel.org/download/1.5.0/userguide-1.5.0/userguide.html" >Here</a><br />For Sample kannel configuration, check <a href="http://www.kannel.org/download/1.4.1/gateway-1.4.1/gw/smskannel.conf">Here</a><br /><br /></div></div>


<h2>Comments</h2>


<div class='comments'>
<div class='comment'>
<div class='author'>Anthony</div>
<div class='content'>
Thanks for this. The send SMS from kannel is not any troublesome. Would you do a guide on receiving SMSs? I have tried everything and but still I cannot received SMS from the same e220 modem that works fine sending from kannel. Thanks again, you guide so far has been very usefull</div>
</div>
<div class='comment'>
<div class='author'>Sreekanth G S</div>
<div class='content'>
Start bearerbox first. Smsbox needs to connect to an already running bearerbox instance. </div>
</div>
</div>

]]></content>
  </entry>
  
</feed>
